"""
Prompt Template Module - Stores the SRT alignment prompt for Gemini
Contains the instructions for how Gemini should align subtitles.
"""


def get_alignment_prompt(original_srt, corrected_transcript):
    """
    Generate the complete prompt for Gemini to align subtitles.

    Args:
        original_srt (str): Content of the original SRT file
        corrected_transcript (str): User's corrected transcript

    Returns:
        str: Complete prompt for Gemini API
    """
    prompt = f"""ä½ æ˜¯ä¸€å€‹å­—å¹•å°é½Šèˆ‡åˆä½µåˆ¤æ–·åŠ©æ‰‹ã€‚
ä»»å‹™ï¼šå°‡å·²æ ¡æ­£å¥½çš„ç¹é«”ä¸­æ–‡é€å¥æ–‡æœ¬ï¼ˆCorrected Linesï¼Œä»¥æ›è¡Œç¬¦åˆ†éš”ï¼‰å°é½Šåˆ°åŸå§‹ SRTï¼ˆOriginal SRTï¼‰çš„æ™‚é–“è»¸ä¸Šã€‚

ğŸ”´ æ ¸å¿ƒéµå¾‹ï¼ˆé•åä»»ä½•ä¸€æ¢éƒ½æ˜¯éŒ¯èª¤ï¼‰ï¼š

1. **ä¸€å°ä¸€åŸå‰‡**ï¼šä¸€å€‹ Corrected Line = ä¸€æ¢æœ€çµ‚å­—å¹•ã€‚çµ•å°ä¸å¯å°‡å…©å€‹ä¸åŒçš„ Corrected Lines åˆä½µæˆä¸€æ¢å­—å¹•ã€‚

2. **18 å­—ç¡¬é™åˆ¶**ï¼šæ¯æ¢æœ€çµ‚å­—å¹•çš„ä¸­æ–‡æ¼¢å­—æ•¸å¿…é ˆ â‰¤ 18 å­—ï¼ˆè‹±æ•¸å­—æ¯å’Œç©ºæ ¼ä¸è¨ˆå…¥ï¼‰ã€‚

3. **ä¸æ‹†åˆ†åŸå‰‡**ï¼šçµ•å°ä¸å¯æ‹†åˆ†ä»»ä½• Corrected Lineã€‚

4. **æ™‚é–“ç¯„åœå¯åˆä½µï¼Œæ–‡å­—ä¸å¯åˆä½µ**ï¼š
   - âœ… å…è¨±ï¼šä¸€å€‹ Corrected Line å°æ‡‰å¤šå€‹åŸå§‹ SRT ç‰‡æ®µçš„åˆä½µæ™‚é–“ç¯„åœ
   - âŒ ç¦æ­¢ï¼šæŠŠå¤šå€‹ Corrected Lines çš„æ–‡å­—æ‹¼æ¥åœ¨ä¸€èµ·

æ±ºç­–åŸå‰‡ï¼ˆè«‹åš´æ ¼éµå®ˆï¼‰

**é è¨­æ“ä½œ**ï¼š
- æ¯å€‹ Corrected Lineï¼ˆä»¥æ›è¡Œåˆ†éš”ï¼‰= ä¸€æ¢ç¨ç«‹çš„æœ€çµ‚å­—å¹•
- é è¨­ä½¿ç”¨ä¸€å°ä¸€æ˜ å°„ï¼ˆL1 -> E1, L2 -> E2...ï¼‰
- åƒ…åœ¨æ‰¾ä¸åˆ°ç²¾ç¢ºä¸€å°ä¸€æ˜ å°„æ™‚ï¼Œæ‰è€ƒæ…®æ™‚é–“ç¯„åœåˆä½µ

**æ™‚é–“ç¯„åœåˆä½µçš„æ¢ä»¶**ï¼ˆå…¨éƒ¨åŒæ™‚æˆç«‹æ‰å¯åˆä½µï¼‰ï¼š

1. è©² Corrected Line åœ¨åŸå§‹ SRT ä¸­å°æ‡‰å¤šå€‹é€£çºŒç‰‡æ®µï¼ˆä¾‹å¦‚ï¼šåŸæœ¬è¢«åˆ‡ç¢çš„åŒä¸€å¥è©±ï¼‰

2. è©² Corrected Line çš„ CJK å­—æ•¸ â‰¤ 18

3. å°æ‡‰çš„ SRT ç‰‡æ®µæ™‚é–“é€£çºŒï¼ˆé–“éš” â‰¤ 500msï¼‰

**æ™‚é–“ç¯„åœåˆä½µçš„æ“ä½œ**ï¼š
- åˆä½µæ™‚é–“ï¼šå–ç¬¬ä¸€å€‹ç‰‡æ®µçš„é–‹å§‹æ™‚é–“ + æœ€å¾Œä¸€å€‹ç‰‡æ®µçš„çµæŸæ™‚é–“
- æ–‡å­—å…§å®¹ï¼šåªæ”¾é€™ä¸€å€‹ Corrected Line çš„æ–‡å­—ï¼ˆä¸æ˜¯æŠŠå¤šå€‹ç‰‡æ®µçš„åŸæ–‡æ‹¼èµ·ä¾†ï¼‰

**çµ•å°ç¦æ­¢çš„æ“ä½œ**ï¼š

âŒ å°‡ã€ŒCorrected Line 1ã€å’Œã€ŒCorrected Line 2ã€çš„æ–‡å­—åˆä½µæˆä¸€æ¢å­—å¹•

âŒ å°‡ä»»ä½• Corrected Line æ‹†æˆå…©æ¢æˆ–å¤šæ¢å­—å¹•

âŒ è¼¸å‡ºä»»ä½•è¶…é 18 å€‹ä¸­æ–‡å­—çš„å­—å¹•ï¼ˆè‹±æ•¸ä¸è¨ˆï¼‰

âŒ å¿½ç•¥ Corrected Lines çš„æ›è¡Œç¬¦ï¼ˆæ¯å€‹æ›è¡Œ = ä¸€æ¢ç¨ç«‹çš„å¥å­ï¼‰

å°é½Šæ¬¡åºï¼šå¾å·¦åˆ°å³ï¼ˆæ™‚é–“é †åºï¼‰ä¾åºå°‡ Corrected Lines é…å°åˆ° SRTã€‚è‹¥ Corrected Lines çš„å¥æ•¸ > SRT ç‰‡æ®µæ•¸ï¼Œåœæ­¢ä¸¦å›å ±éœ€è¦æ›´ç²—é¡†ç²’çš„å¥å­ï¼›è‹¥å¥æ•¸ < ç‰‡æ®µæ•¸ï¼Œæ‰é€²è¡Œã€Œæ™‚é–“ç¯„åœåˆä½µã€ï¼ˆä½†ä»åªå¡«å…¥ä¸€å€‹ Corrected Line çš„æ–‡å­—ï¼‰ã€‚

è¼¸å‡ºæ ¼å¼ï¼šæœ€å¾Œè¼¸å‡ºæœ‰æ•ˆ SRTï¼ˆå¸¶ç·¨è™Ÿã€æ™‚é–“ç¢¼ã€æ–‡å­—ï¼‰ï¼Œæ¯å€‹æ¢ç›®åªæœ‰è©²å¥ç¹é«”ä¸­æ–‡ï¼ˆå¦‚éœ€é›™èªï¼Œå°‡åœ¨åˆ¥è™•è™•ç†ï¼Œé€™è£¡åƒ…ç”Ÿæˆä¸­æ–‡ï¼‰ã€‚

è¼¸å‡ºæ­¥é©Ÿï¼ˆå…©æ®µå¼è¼¸å‡ºï¼‰

ç¬¬ 1 æ®µï¼šå°é½Šã€Œæ˜ å°„è¡¨ã€ï¼ˆè«‹å…ˆè¼¸å‡ºé€™å¼µè¡¨ï¼Œä¾›æˆ‘ä¸€çœ¼æª¢æŸ¥ï¼‰

è«‹å…ˆè¼¸å‡ºä¸€å¼µç°¡è¡¨ï¼Œæ ¼å¼å¦‚ä¸‹ï¼ˆåƒ…æ–‡å­—ï¼Œä¸è¦æ™‚é–“ç¢¼ï¼‰ï¼š

# MAPPING
L1 -> E1..E2        # è¡¨ç¤º Corrected Line 1 å°æ‡‰åŸå§‹ SRT ç‰‡æ®µ 1 åˆ° 2ï¼ˆé€£çºŒï¼‰
L2 -> E3            # è¡¨ç¤º Corrected Line 2 å°æ‡‰ç‰‡æ®µ 3
L3 -> E4..E6
...

è¦å‰‡ï¼š

- é è¨­æ˜¯ä¸€å°ä¸€ï¼ˆLk -> Exï¼‰ã€‚
- åƒ…åœ¨åš´æ ¼æ¢ä»¶æˆç«‹æ™‚æ‰å‡ºç¾ç¯„åœï¼ˆå¦‚ E4..E6ï¼‰ã€‚
- ä¸å¾—ç”¢ç”Ÿã€Œä¸€å€‹ Lk å°æ‡‰å…©å€‹ä¸é€£çºŒç‰‡æ®µã€æˆ–ã€Œå…©å€‹ä¸åŒ Lk å°æ‡‰åŒä¸€ç‰‡æ®µã€çš„æƒ…å½¢ã€‚
- è‹¥ Corrected Lines æ¯” SRT å¤šï¼Œè«‹åœ¨è¡¨æ ¼æœ€å¾Œå›å ±ï¼šERROR: corrected lines (m) > srt entries (n). ä¸¦åœæ­¢ã€‚

ç¬¬ 2 æ®µï¼šæœ€çµ‚ SRT

åœ¨æ˜ å°„è¡¨ä¹‹å¾Œï¼Œç©ºä¸€è¡Œï¼Œè¼¸å‡ºå®Œæ•´æœ‰æ•ˆ SRTï¼š

- å°‡æ¯å€‹ Lk æ”¾å…¥å…¶å°æ‡‰ç‰‡æ®µçš„åˆä½µæ™‚é–“ç¯„åœï¼ˆstart = group.first.start, end = group.last.endï¼‰ã€‚
- æ–‡å­—åƒ…ç‚ºè©²æ¢ Corrected Line çš„ç¹ä¸­å¥å­æœ¬èº«ï¼›ä¸å¯æ‹¼æ¥å¤šå¥ã€‚
- æ¯æ¢çš„ä¸­æ–‡æ¼¢å­—æ•¸ â‰¤ 18ï¼ˆè‹±æ•¸èˆ‡ç©ºæ ¼ä¸è¨ˆå…¥æ­¤é™åˆ¶ï¼‰ã€‚
- è‡ªå‹•å¾ 1 é–‹å§‹é€£çºŒç·¨è™Ÿï¼Œæ™‚é–“ç¢¼æ ¼å¼æ¨™æº–ï¼ˆhh:mm:ss,SSS --> hh:mm:ss,SSSï¼‰ã€‚

ç¯„ä¾‹ï¼ˆç°¡åŒ–ï¼‰

Original SRTï¼ˆæ‘˜è¦ï¼‰
E1: 00:00:01,000 â†’ 00:00:01,800 ã€Œè€è”¡ã€
E2: 00:00:01,900 â†’ 00:00:03,000 ã€Œå°±æ˜¯ä»–æ²’æœ‰æ¶ˆå¤±å•Šã€

Corrected Lines
L1: ã€Œè€è”¡ å°±æ˜¯ä»–æ²’æœ‰æ¶ˆå¤±å•Šã€ ï¼ˆCJK=11ï¼‰

å…è¨±çš„è¼¸å‡ºï¼š

# MAPPING
L1 -> E1..E2

1
00:00:01,000 --> 00:00:03,000
è€è”¡ å°±æ˜¯ä»–æ²’æœ‰æ¶ˆå¤±å•Š

ä¸å…è¨±çš„è¼¸å‡ºï¼š
- å°‡ L1 èˆ‡å…¶ä»– L åˆä½µåˆ°åŒä¸€æ¢ï¼ˆâŒï¼‰ã€‚
- ç”¢ç”Ÿä¸­æ–‡ >18ï¼ˆâŒï¼‰ã€‚

---

è¼¸å…¥è³‡æ–™

Original SRTï¼š

{original_srt}

Corrected Linesï¼ˆæ¯è¡Œä¸€å€‹å¥å­ï¼Œå·²éµå®ˆ â‰¤18 CJKï¼‰ï¼š

{corrected_transcript}

---

è«‹ç›´æ¥è¼¸å‡ºå…©æ®µï¼šç¬¬ä¸€æ®µç‚º # MAPPING è¡¨ï¼Œç©ºè¡Œå¾Œæ¥ç¬¬äºŒæ®µå®Œæ•´ SRTã€‚"""

    return prompt


def get_test_prompt():
    """
    Generate a simple test prompt to verify Gemini connection.

    Returns:
        str: Test prompt
    """
    return "Please respond with 'Connection successful' if you can read this message."
